sudo: false

services: docker

before_install:
  # Check commit matches expected commit (because of Travis bug)
  - |
    if [[ "$TRAVIS_COMMIT" != "$(git rev-parse HEAD)" ]]; then
      echo "Commit $(git rev-parse HEAD) doesn't match expected commit $TRAVIS_COMMIT"
    fi

stages:
 - build 
 - test
 - name: deploy
    if: branch = master

jobs:
  include:
  - stage: build
    script: docker-compose build

  - stage: test
    script: 
      - ./Server/test
      - ./client/test
  - stage: deploy
    script: echo "... deploy ... "

branches:
  only:
    - master
