<!DOCTYPE html>
<html>
<header>
	<title>
	Selfaware Monopoly InGame
	</title>
</header>
<body>
<div id="PlayerStatsDiv" />

<script>
var knownId = 0

function getPlayerName() {
	var url_string = window.location.href
	var url = new URL(url_string);
	return url.searchParams.get("playerName");
}

function addPlayerNameElement(player) {
	var nameField = document.createElement("h1");
	var node = document.createTextNode(player);
	nameField.appendChild(node);
	
	var element = document.getElementById("PlayerStatsDiv");
	element.appendChild(nameField);
}

function log(message) {
	console.log(message);
}

function getAPIRoot() {
	var url = window.location.href
	var arr = url.split("/")
	return arr[0] + "//" + arr[2]
}

function getGameURL() {
	return getAPIRoot() + "/game"
}

function getRollDiceMessage() {
	var obj = {"player": player, "action":{"name":"rollDice"}, "id" : knownId}
	return JSON.stringify(obj)
}

function handleResponse(response) {
	obj = JSON.parse(response);
	if(obj[obj.length-1] != undefined && obj[obj.length-1].hasOwnProperty("id"))
		knownId = obj[obj.length-1].id
	
	log(obj)
}

function rollDice() {
	var url = getGameURL()
	var content = getRollDiceMessage()
	
	var xmlHttp = new XMLHttpRequest();
    xmlHttp.onreadystatechange = function() { 
        if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
            handleResponse(xmlHttp.responseText);
    }
    xmlHttp.open("POST", url, true); // true for asynchronous 
    xmlHttp.send(content);
}

function getStartGameMessage() {
	var obj = {"action":{"name":"startGame"}}
	return JSON.stringify(obj)
}

function startGame() {
	var url = getGameURL()
	var content = getStartGameMessage()
	
	var xmlHttp = new XMLHttpRequest();
    xmlHttp.onreadystatechange = function() { 
        if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
            handleResponse(xmlHttp.responseText);
    }
    xmlHttp.open("POST", url, true); // true for asynchronous 
    xmlHttp.send(content);
}


var player = getPlayerName()
addPlayerNameElement(player)
</script>


<div id="BoardDiv">
	<p>This could be a game board soon.</p>

</div>
<div id="ControllDiv">
	<p><button onclick="rollDice()"><b>RollDice</b></button></p>
	<p><button onclick="startGame()"><b>StartGame</b></button></p>
</div>

</body>
</html>
